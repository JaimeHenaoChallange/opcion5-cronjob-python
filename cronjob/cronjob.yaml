apiVersion: batch/v1
kind: CronJob
metadata:
  name: deploy-checker
  namespace: argocd
spec:
  schedule: "*/2 * * * *"  # Ejecuta cada 5 minutos
  concurrencyPolicy: Forbid  # No permite que se ejecute un nuevo Job si ya hay uno en ejecuci√≥n
  jobTemplate:
    spec:
      template:
        spec:
          containers:
            - name: deploy-checker
              image: jaimehenao8126/opcion5-deploy-script:e485cc97e2727e8147d00787fb1e743ce322d27e
              envFrom:
                - secretRef:
                    name: slack-webhook-secret
              env:
                - name: ARGOCD_SERVER
                  value: "localhost:8080"
                - name: ARGOCD_USERNAME
                  value: "admin"
                - name: ARGOCD_PASSWORD
                  valueFrom:
                    secretKeyRef:
                      name: argocd-secret  # Se mantiene el secreto correcto
                      key: admin.password  # Cambiado para usar la clave correcta
          restartPolicy: OnFailure
